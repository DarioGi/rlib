dnl Configure template for RLIB

dnl Copyright (c) 2003 SICOM Systems Inc (bdoan@sicompos.com)
dnl RLIB is free software; you can redistribute it and/or modify
dnl it under the terms of the GNU General Public License as published by
dnl the Free Software Foundation; either version 2, or (at your option)
dnl any later version.

dnl RLIB is distributed in the hope that it will be useful,
dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl GNU General Public License for more details.

dnl You should have received a copy of the GNU General Public License
dnl along with this program; if not, write to the Free Software
dnl Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
dnl 02111-1307, USA.

dnl Report bugs to rlib-devel@lists.sourceforge.net
dnl
dnl Process this file with autoconf to produce a configure script.



AC_INIT(libsrc/rlib.h)
AM_INIT_AUTOMAKE(rlib, 1.1.3)
AM_MAINTAINER_MODE
AC_DISABLE_STATIC
RLIB_VERSION=1.1.3
AC_SUBST(RLIB_VERSION)

dnl Checks for programs.
AC_PROG_CC
AC_PROG_MAKE_SET
AC_PROG_INSTALL

AC_LIBTOOL_DLOPEN
AC_LIBLTDL_CONVENIENCE
AC_PROG_LIBTOOL
AC_SUBST(INCLTDL)
AC_SUBST(LIBLTDL)

dnl Checks for libraries.
AC_CHECK_LIB(c, exit)
AC_CHECK_LIB(m, exp)

AC_PATH_PROG(PKG_CONFIG, pkg-config, no)

PKG_CHECK_MODULES(LIBXML, libxml-2.0 >= 2.4.0)
AC_SUBST(LIBXML_LIBS)
AC_SUBST(LIBXML_CFLAGS)


AC_ARG_ENABLE(mysql,              [  --disable-mysql         disable mysql backend],,enable_mysql=yes)
MYSQL_CFLAGS=""
MYSQL_LIBS=""
if test x$enable_mysql = xyes; then
	AC_PATH_PROG(MYSQL_CONFIG, mysql_config, no)
	if test x$MYSQL_CONFIG = xno; then
		echo "*** WARNING: MYSQL NOT FOUND IN PATH.  RLIB WILL NOT BE COMPILED WITH SUPPORT FOR IT"
		enable_mysql=no	
	else
		AC_DEFINE(HAVE_MYSQL,1,[Build with MYSQL support])
		MYSQL_CFLAGS=`$MYSQL_CONFIG --cflags`
		MYSQL_LIBS=`$MYSQL_CONFIG --libs`
	fi
fi
AC_SUBST(MYSQL_CFLAGS)
AC_SUBST(MYSQL_LIBS)
AM_CONDITIONAL(HAVE_MYSQL, test x$enable_mysql = xyes)


AC_ARG_ENABLE(postgre,              [  --disable-postgre       disable postgre backend],,enable_postgre=yes)
POSTGRE_CFLAGS=""
POSTGRE_LIBS=""
if test x$enable_postgre = xyes; then
	AC_PATH_PROG(POSTGRE_CONFIG, pg_config, no)
	if test x$POSTGRE_CONFIG = xno; then
		echo "*** WARNING: POSTGRE NOT FOUND IN PATH.  RLIB WILL NOT BE COMPILED WITH SUPPORT FOR IT"
		enable_postgre=no
	else
		AC_DEFINE(HAVE_POSTGRE,1,[Build with POSTGRE support])
		POSTGRE_CFLAGS="-I `$POSTGRE_CONFIG --includedir`"
		POSTGRE_LIBS="-L`$POSTGRE_CONFIG --libdir` -lpq"
	fi
fi
AC_SUBST(POSTGRE_CFLAGS)
AC_SUBST(POSTGRE_LIBS)
AM_CONDITIONAL(HAVE_POSTGRE, test x$enable_postgre = xyes)


AC_ARG_ENABLE(php,              [  --disable-php         disable php frontent],,enable_php=yes)
PHP_CFLAGS=""
PHP_EXTENSION_DIR=""
if test x$enable_php = xyes; then
	AC_PATH_PROG(PHP_CONFIG, php-config, no)
	if test x$PHP_CONFIG = xno; then
		echo "*** WARNING: PHP NOT FOUND IN PATH.  RLIB WILL NOT BE COMPILED WITH SUPPORT FOR IT"
		enable_php=no
	else
		AC_DEFINE(HAVE_PHP,1,[Build with PHP support])
		PHP_CFLAGS=`$PHP_CONFIG --includes`
		PHP_EXTENSION_DIR=`$PHP_CONFIG --extension-dir`
	fi
fi
AC_SUBST(PHP_CFLAGS)
AC_SUBST(PHP_EXTENSION_DIR)
AC_SUBST(HAVE_PHP)
AM_CONDITIONAL(HAVE_PHP, test x$enable_php = xyes)

AC_ARG_ENABLE(python,              [  --disable-python      disable python frontent],,enable_python=yes)
PYTHON_CFLAGS=""
PYTHON_EXTENSION_DIR=""
if test x$enable_python = xyes; then
	AM_PATH_PYTHON(2.2)
	if test x$PYTHON_VERSION = x2.2; then
		AC_DEFINE(HAVE_PYTHON,1,[Build with PYTHON support])
		PYTHON_CFLAGS="-I $PYTHON_PREFIX/include/python$PYTHON_VERSION"
		PYTHON_EXTENSION_DIR=$pyexecdir
	else
		echo "*** WARNING: PYTHON 2.2 NOT FOUND IN PATH.  RLIB WILL NOT BE COMPILED WITH SUPPORT FOR IT"
		enable_python=no
	fi
fi
AC_SUBST(HAVE_PYTHON)
AC_SUBST(PYTHON_CFLAGS)
AC_SUBST(PYTHON_EXTENSION_DIR)
AM_CONDITIONAL(HAVE_PYTHON, test x$enable_python = xyes)

dnl Checks for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(fcntl.h unistd.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST

dnl Checks for library functions.

AC_OUTPUT([
Makefile
rlib.pc
libsrc/Makefile
bindings/Makefile
bindings/php/Makefile
bindings/python/Makefile
inputs/Makefile
inputs/mysql/Makefile
inputs/postgre/Makefile
tests/Makefile
])


echo "
rlib-$VERSION:

	prefix:                   ${prefix}
	compiler:                 ${CC}

	INPUTS:
	 MYSQL:                   ${enable_mysql}
	 POSTGRE:                 ${enable_postgre}

	BINDINGS:
	 PHP:                     ${enable_php}
	  PHP entension dir:      ${PHP_EXTENSION_DIR}
	 PYTHON:                  ${enable_python}
	  PYTHON entension dir:   ${PYTHON_EXTENSION_DIR}

	WOCKET:                   In My Pocket
"
